#!/bin/sh

[ $# -ne 1 ] && { echo "$0: missing file operand"; exit 1; }

FILE=${1}
SESSION=$(basename "$FILE" .conf)

[ ! -f "$FILE" ] && { echo "$0: cannot stat ‘${FILE}’: No such file"; exit 1; }

if ! tmux has-session -t "$SESSION" > /dev/null 2>&1
then
  TMUX='' tmux new-session -d -s "$SESSION"
  xargs -L1 tmux < "$FILE"
  tmux select-window -t 1
fi

if [ -z "$TMUX" ]
then
  tmux attach -t "$SESSION"
else
  tmux switch-client -t "$SESSION"
fi

