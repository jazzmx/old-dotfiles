#!/bin/sh

: "${CHEAT_DIR:=$HOME/.config/cheat}"

USAGE="
 cheat          List available cheats
 cheat app      Print cheat for app
 cheat -e app   Edit cheat for app using EDITOR variable
"

# No args = list available cheat
[ "$1" ] || { ls $CHEAT_DIR ; exit; }
op=show
while [ "$1" ]; do
   case "$1" in
      -h|--help) echo "$USAGE" ; exit ;;
      -e) op=edit ;;
      *) file="$1" ;;
   esac
   shift
done


if [ "$op" = "edit" ]; then
   [ ! -d "$CHEAT_DIR" ] && mkdir -p $CHEAT_DIR
   ${EDITOR:-vi} $CHEAT_DIR/$file
   echo "$CHEAT_DIR/$file"
else
   # Use bat if available
   viewer=$([ "$(which bat)" ] && echo bat || echo ${PAGER:-less})
   [ -f "$CHEAT_DIR/$file" ] || { echo "Could not find '$file' cheatsheet!"; exit 1; }
   $viewer "$CHEAT_DIR/$file"
   echo
fi

